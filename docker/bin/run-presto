#!/bin/bash

set -xeuo pipefail

if [[ ! -d /usr/lib/presto/etc ]]; then
    if [[ -d /etc/presto ]]; then
        ln -s /etc/presto /usr/lib/presto/etc
    else
        ln -s /usr/lib/presto/default/etc /usr/lib/presto/etc
    fi
fi

node_id=()
if ! grep -s -q 'node.id' /usr/lib/presto/etc/node.properties; then
    node_id=("-Dnode.id=${HOSTNAME}")
fi

exec /usr/lib/presto/bin/launcher run "${node_id[@]}" "$@"
