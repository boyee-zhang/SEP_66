name: upload
description: "Upload test results, reports, and heap dump."
inputs:
  name-suffix:
    default: ${{ github.job }}
  upload-results:
    default: false
  upload-heap-dump:
    default: false
  test-report-retention-days:
    default: 5
  heap-dump-retention-days:
    default: 14

runs:
  using: composite
  steps:
    - name: Upload test results
      uses: actions/upload-artifact@v3
      if: always() && inputs.upload-results
      with:
        name: result ${{ inputs.name-suffix }}
        if-no-files-found: 'ignore'
        path: |
          **/target/surefire-reports
          **/target/checkstyle-*
    - name: Upload test report
      uses: actions/upload-artifact@v3
      if: always()
      with:
        # Name prefix is checked in the `Annotate checks` workflow
        name: test report ${{ inputs.name-suffix }}
        path: |
          **/surefire-reports/TEST-*.xml
        retention-days: ${{ inputs.test-report-retention-days }}
    - name: Upload heap dump
      uses: actions/upload-artifact@v3
      if: always() && inputs.upload-heap-dump
      with:
        name: heap dump ${{ github.job }}
        if-no-files-found: 'ignore'
        path: |
          **/*.hprof
        retention-days: ${{ inputs.heap-dump-retention-days }}
